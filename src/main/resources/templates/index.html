<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>MailCraft — AI Email Reply Generator</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect width='64' height='64' rx='14' fill='%23ea580c'/><rect x='10' y='18' width='44' height='30' rx='4' fill='none' stroke='white' stroke-width='3'/><polyline points='10,18 32,36 54,18' fill='none' stroke='white' stroke-width='3' stroke-linejoin='round'/></svg>"/>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
          --bg: #f5f5f0;
          --surface: #ffffff;
          --surface2: #f9f9f7;
          --border: #e4e4dc;
          --accent: #ea580c;
          --accent2: #c2410c;
          --text: #1a1a1a;
          --muted: #9a9a8a;
          --success: #16a34a;
          --radius: 12px;
        }

        body {
          background: var(--bg);
          color: var(--text);
          font-family: 'DM Sans', sans-serif;
          min-height: 100vh;
          overflow-x: hidden;
        }

        body::before {
          content: '';
          position: fixed;
          inset: 0;
          background:
            radial-gradient(ellipse 80% 60% at 20% 0%, rgba(234,88,12,0.05) 0%, transparent 60%),
            radial-gradient(ellipse 60% 40% at 80% 100%, rgba(234,88,12,0.03) 0%, transparent 60%);
          pointer-events: none;
          z-index: 0;
        }

        /* ── Page Loader ── */
        #page-loader {
          position: fixed;
          inset: 0;
          background: #fff;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 20px;
          z-index: 999;
          transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        #page-loader.hidden { opacity: 0; visibility: hidden; }
        .loader-icon {
          width: 56px; height: 56px;
          background: var(--accent);
          border-radius: 16px;
          display: flex; align-items: center; justify-content: center;
          animation: iconPulse 1.4s ease-in-out infinite;
        }
        .loader-bar-wrap {
          width: 150px; height: 3px;
          background: #ececec;
          border-radius: 99px; overflow: hidden;
        }
        .loader-bar-fill {
          height: 100%; width: 0;
          background: var(--accent);
          border-radius: 99px;
          animation: barFill 1.3s cubic-bezier(0.4,0,0.2,1) forwards;
        }
        .loader-label {
          font-family: 'DM Mono', monospace;
          font-size: 0.68rem; letter-spacing: 0.18em;
          text-transform: uppercase; color: var(--muted);
        }

        @keyframes iconPulse {
          0%   { box-shadow: 0 0 0 0 rgba(234,88,12,0.4); transform: scale(1); }
          50%  { box-shadow: 0 0 0 12px rgba(234,88,12,0); transform: scale(1.05); }
          100% { box-shadow: 0 0 0 0 rgba(234,88,12,0); transform: scale(1); }
        }
        @keyframes barFill { from { width: 0% } to { width: 100% } }

        /* ── Layout ── */
        .container {
          position: relative; z-index: 1;
          max-width: 860px; margin: 0 auto;
          padding: 48px 24px 80px;
        }

        header {
          text-align: center; margin-bottom: 52px;
          animation: fadeDown 0.7s ease 1.2s both;
        }

        .header-logo {
          display: inline-flex; align-items: center; justify-content: center;
          width: 54px; height: 54px;
          background: var(--accent); border-radius: 15px;
          margin-bottom: 18px;
          box-shadow: 0 6px 20px rgba(234,88,12,0.28);
        }

        h1 { font-family: 'Playfair Display', serif; font-size: clamp(2rem, 5vw, 3rem); font-weight: 700; letter-spacing: -0.02em; line-height: 1.1; }
        h1 span { color: var(--accent); }
        .subtitle { margin-top: 10px; color: var(--muted); font-size: 0.95rem; font-weight: 300; letter-spacing: 0.02em; }

        /* ── Divider ── */
        .divider { display: flex; align-items: center; gap: 12px; margin: 36px 0; }
        .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }
        .divider span { color: var(--muted); font-family: 'DM Mono', monospace; font-size: 0.7rem; letter-spacing: 0.15em; text-transform: uppercase; }

        /* ── Card ── */
        .card {
          background: var(--surface); border: 1px solid var(--border);
          border-radius: var(--radius); padding: 32px;
          animation: fadeUp 0.7s ease 1.3s both;
          box-shadow: 0 4px 24px rgba(0,0,0,0.06);
        }

        .field-label {
          display: block; font-family: 'DM Mono', monospace;
          font-size: 0.7rem; letter-spacing: 0.12em;
          text-transform: uppercase; color: var(--muted); margin-bottom: 10px;
        }

        textarea {
          width: 100%; background: var(--surface2);
          border: 1px solid var(--border); border-radius: 8px;
          color: var(--text); font-family: 'DM Sans', sans-serif;
          font-size: 0.92rem; line-height: 1.6; padding: 16px;
          resize: vertical; min-height: 160px;
          transition: border-color 0.2s, box-shadow 0.2s; outline: none;
        }
        textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(234,88,12,0.1); }
        textarea::placeholder { color: var(--muted); }

        /* ── Tone pills ── */
        .tone-row { display: flex; flex-wrap: wrap; gap: 8px; }
        .tone-btn {
          padding: 7px 18px; border-radius: 999px;
          border: 1px solid var(--border); background: transparent;
          color: var(--muted); font-family: 'DM Sans', sans-serif;
          font-size: 0.85rem; cursor: pointer; transition: all 0.18s ease;
        }
        .tone-btn:hover { border-color: var(--accent); color: var(--accent); }
        .tone-btn.active { background: var(--accent); border-color: var(--accent); color: #fff; font-weight: 500; }

        /* Hidden radio inputs for Thymeleaf form binding */
        .tone-radio { display: none; }

        /* ── Submit button ── */
        .btn-generate {
          margin-top: 28px; width: 100%; padding: 15px;
          background: var(--accent); color: #fff; border: none;
          border-radius: 8px; font-family: 'DM Sans', sans-serif;
          font-size: 0.95rem; font-weight: 500; letter-spacing: 0.02em;
          cursor: pointer; transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
          display: flex; align-items: center; justify-content: center; gap: 10px;
          position: relative; overflow: hidden;
        }
        .btn-generate::after {
          content: ''; position: absolute; top: 0; left: -100%;
          width: 60%; height: 100%;
          background: linear-gradient(120deg, transparent, rgba(255,255,255,0.2), transparent);
          transition: left 0.5s ease;
        }
        .btn-generate:hover::after { left: 160%; }
        .btn-generate:hover { background: var(--accent2); transform: translateY(-1px); box-shadow: 0 6px 20px rgba(234,88,12,0.3); }

        /* ── Output box ── */
        .output-section { margin-top: 28px; }
        .output-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }

        .btn-copy {
          display: flex; align-items: center; gap: 6px;
          padding: 6px 14px; background: transparent;
          border: 1px solid var(--border); border-radius: 6px;
          color: var(--muted); font-family: 'DM Mono', monospace;
          font-size: 0.72rem; letter-spacing: 0.08em;
          text-transform: uppercase; cursor: pointer; transition: all 0.18s;
        }
        .btn-copy:hover { border-color: var(--accent); color: var(--accent); }
        .btn-copy.copied { border-color: var(--success); color: var(--success); }

        .output-box {
          background: var(--surface2); border: 1px solid var(--border);
          border-radius: 8px; padding: 20px;
          font-size: 0.92rem; line-height: 1.7;
          white-space: pre-wrap; color: var(--text);
          font-family: 'DM Sans', sans-serif;
          animation: fadeUp 0.5s ease both;
        }

        /* ── Animations ── */
        @keyframes fadeDown { from { opacity: 0; transform: translateY(-16px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeUp   { from { opacity: 0; transform: translateY(16px);  } to { opacity: 1; transform: translateY(0); } }

        .field + .field { margin-top: 24px; }
    </style>
</head>
<body>

<!-- Page Loader -->
<div id="page-loader">
    <div class="loader-icon">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="4" width="20" height="16" rx="2"/>
            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
        </svg>
    </div>
    <div class="loader-bar-wrap"><div class="loader-bar-fill"></div></div>
    <p class="loader-label">Loading MailCraft…</p>
</div>

<div class="container">
    <header>
        <div class="header-logo">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="4" width="20" height="16" rx="2"/>
                <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
            </svg>
        </div>
        <h1>Mail<span>Craft</span></h1>
        <p class="subtitle">AI-powered professional email reply generator</p>
    </header>

    <div class="card">
        <!-- Thymeleaf form bound to EmailRequest -->
        <form th:action="@{/generate}" th:object="${emailRequest}" method="post">

            <!-- Email content -->
            <div class="field">
                <label class="field-label" for="emailContent">Original Email</label>
                <textarea id="emailContent" th:field="*{emailContent}"
                          placeholder="Paste the email you want to reply to..."></textarea>
            </div>

            <!-- Tone selector (pill UI + hidden field) -->
            <div class="field">
                <span class="field-label">Tone</span>
                <div class="tone-row" id="toneRow">
                    <button type="button" class="tone-btn active" data-tone="Professional">Professional</button>
                    <button type="button" class="tone-btn" data-tone="Friendly">Friendly</button>
                    <button type="button" class="tone-btn" data-tone="Formal">Formal</button>
                    <button type="button" class="tone-btn" data-tone="Casual">Casual</button>
                    <button type="button" class="tone-btn" data-tone="Assertive">Assertive</button>
                    <button type="button" class="tone-btn" data-tone="Empathetic">Empathetic</button>
                </div>
                <!-- Hidden input bound to EmailRequest.tone — updated by JS -->
                <input type="hidden" id="toneInput" th:field="*{tone}" value="Professional"/>
            </div>

            <!-- Submit -->
            <button type="submit" class="btn-generate">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m3 3 3 9-3 9 19-9Z"/><path d="M6 12h16"/>
                </svg>
                Generate Reply
            </button>

        </form>

        <!-- Output — shown only when generatedReply is present -->
        <div class="output-section" th:if="${generatedReply}">
            <div class="divider"><span>Generated Reply</span></div>
            <div class="output-header">
                <span class="field-label" style="margin:0">Result</span>
                <button class="btn-copy" id="copyBtn" onclick="copyReply()">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                    Copy
                </button>
            </div>
            <div class="output-box" id="outputBox" th:text="${generatedReply}"></div>
        </div>

    </div><!-- /card -->
</div><!-- /container -->

<script>
    // Page loader
    window.addEventListener('load', () => {
      setTimeout(() => document.getElementById('page-loader').classList.add('hidden'), 1400);
    });

    // Tone pill selection → update hidden input
    const toneButtons = document.querySelectorAll('.tone-btn');
    const toneInput   = document.getElementById('toneInput');

    toneButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        toneButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        toneInput.value = btn.dataset.tone;
      });
    });

    // Restore active pill from server-side value on page reload
    const savedTone = toneInput.value;
    if (savedTone) {
      toneButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tone === savedTone);
      });
    }

    // Typewriter effect on output (runs once after form submit)
    window.addEventListener('DOMContentLoaded', () => {
      const box = document.getElementById('outputBox');
      if (!box) return;
      const fullText = box.textContent;
      box.textContent = '';
      box.style.borderRight = '2px solid var(--accent)';

      let i = 0;
      const speed = Math.max(8, Math.min(18, Math.floor(8000 / fullText.length)));
      const type = () => {
        if (i < fullText.length) {
          box.textContent += fullText[i++];
          setTimeout(type, speed);
        } else {
          box.style.borderRight = 'none';
        }
      };
      type();
    });

    // Copy to clipboard
    function copyReply() {
      const box = document.getElementById('outputBox');
      const btn = document.getElementById('copyBtn');
      navigator.clipboard.writeText(box.textContent).then(() => {
        btn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Copied!`;
        btn.classList.add('copied');
        setTimeout(() => {
          btn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg> Copy`;
          btn.classList.remove('copied');
        }, 2000);
      });
    }
</script>
</body>
</html>